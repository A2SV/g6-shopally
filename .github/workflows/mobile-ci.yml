# -----------------------------------------------------------------------------
# Workflow Name: Flutter Mobile CI
#
# Description:
# This workflow runs on push and pull requests to main branches for the
# Flutter mobile project. It performs tests and builds the app.
# -----------------------------------------------------------------------------
name: Flutter Mobile CI

# -----------------------------------------------------------------------------
# Trigger Conditions
# -----------------------------------------------------------------------------
on:
  push:
    branches:
      - main
      - ShopallyMobile-main
    paths:
      - 'shopallymobile/**'
  pull_request:
    branches:
      - main
      - ShopallyMobile-main
    paths:
      - 'shopallymobile/**'

# -----------------------------------------------------------------------------
# Jobs: Tasks to execute
# -----------------------------------------------------------------------------
jobs:
  flutter-ci:
    runs-on: ubuntu-latest

    defaults:
      run:
        working-directory: shopallymobile

    steps:
      # Step 1: Checkout repository
      - name: âœ… 1. Checkout Repository
        uses: actions/checkout@v4

      # Step 2: Skip Flutter setup (uses local runner version)

      # Step 3: Get Flutter dependencies
      - name: ðŸ“¦ 2. Install Dependencies
        run: flutter pub get

      # Step 4: Run unit tests
      - name: ðŸ§ª 3. Run Tests
        run: flutter test --coverage

      # Step 5: Check code formatting
      - name: ðŸŽ¨ 4. Check Code Formatting
        run: |
          if [[ -n $(dart format --set-exit-if-changed .) ]]; then
            echo "Some files are not formatted correctly."
            exit 1
          fi

      # Step 6: Build the app (APK)
      - name: ðŸ“± 5. Build APK
        run: flutter build apk --release