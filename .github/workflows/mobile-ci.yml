# -----------------------------------------------------------------------------
# Workflow Name: Flutter Mobile CI
#
# Description:
# This workflow runs on push and pull requests to main branches for the
# Flutter mobile project. It performs tests and builds the app.
# -----------------------------------------------------------------------------
name: Flutter Mobile CI

# -----------------------------------------------------------------------------
# Trigger Conditions
# -----------------------------------------------------------------------------
on:
  push:
    branches:
      - main
      - ShopallyMobile-main
    paths:
      - 'shopallymobile/**'
  pull_request:
    branches:
      - main
      - ShopallyMobile-main
    paths:
      - 'shopallymobile/**'

# -----------------------------------------------------------------------------
# Jobs: Tasks to execute
# -----------------------------------------------------------------------------
jobs:
  flutter-ci:
    runs-on: ubuntu-latest

    defaults:
      run:
        working-directory: shopallymobile

    steps:
      # Step 1: Checkout repository
      - name: ‚úÖ 1. Checkout Repository
        uses: actions/checkout@v4

      # Step 2: Set up Flutter
      - name: ‚öôÔ∏è 2. Set up Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.32.8'
          cache: true

      # Step 3: Get Flutter dependencies
      - name: üì¶ 3. Install Dependencies
        run: flutter pub get

      # # Step 4: Run unit tests
      # - name: üß™ 4. Run Tests
      #   run: flutter test --coverage

      # # Step 5: Check code formatting
      # - name: üé® 5. Check Code Formatting
      #   run: |
      #     echo "Checking Dart code formatting..."
      #     # Check if any files need formatting
      #     FORMAT_OUTPUT=$(dart format --set-exit-if-changed .)
      #     if [ -n "$FORMAT_OUTPUT" ]; then
      #       echo "Some files are not formatted correctly:"
      #       echo "$FORMAT_OUTPUT"
      #       exit 1
      #     else
      #       echo "All files are properly formatted."
      #     fi



      # # Step 6: Build the app (APK)
      # - name: üì± 6. Build APK
      #   run: flutter build apk --release

      # Optional: Build iOS app (if macOS runner)
      # - name: üì± 7. Build iOS
      #   runs-on: macos-latest
      #   run: flutter build ios --release

      # Optional: Upload artifacts (APK/coverage)
      # - name: üì§ 8. Upload Artifacts
      #   uses: actions/upload-artifact@v3
      #   with:
      #     name: build-apk
      #     path: build/app/outputs/flutter-apk/app-release.apk
